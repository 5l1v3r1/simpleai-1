version: '{build}'

os: Visual Studio 2015

platform:
  - x86
  - x64

configuration:
  - Debug
  - Release

branches:
  only:
  - master

clone_depth: 10

install:
  - set QTDIR=C:\Qt\5.7\msvc2015
  - set PATH=%PATH%;%QTDIR%\bin;C:\MinGW\bin

before_build:
  - cmake -G"Visual Studio 14 2015" -DSIMPLEAI_DEBUGGER=ON -DCMAKE_PREFIX_PATH="%QT5DIR%"
  # This cuts down on a lot of noise generated by xamarin warnings.
  - del "C:\Program Files (x86)\MSBuild\14.0\Microsoft.Common.targets\ImportAfter\Xamarin.Common.targets"

build:
  parallel: true
  verbosity: minimal
  project: ALL_BUILD.vcxproj

artifacts:
  - name: Runner
    path: simpleai-run.exe

test_script:
  - cmd: simpleai-tests --gtest_output=xml:tests.xml --gtest_filter=-ZoneTest*:LUAAIRegistryTest*

on_finish:
  - ps: (new-object net.webclient).UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\tests.xml))

matrix:
  fast_finish: true
